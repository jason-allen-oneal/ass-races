{"code":"import { __extends } from \"tslib\";\r\nimport Button from '../components/button.js';\r\nimport ScoreModal from '../components/score-modal.js';\r\nvar GameOverScene = /** @class */ (function (_super) {\r\n    __extends(GameOverScene, _super);\r\n    function GameOverScene() {\r\n        return _super.call(this, { key: 'gameOverScene' }) || this;\r\n    }\r\n    GameOverScene.prototype.init = function (data) {\r\n        this.ass = data.ass;\r\n        this.winner = data.winner;\r\n        this.opponents = data.opponents;\r\n    };\r\n    GameOverScene.prototype.preload = function () {\r\n        /*\r\n        this.plugins.get('rexwebfontloaderplugin').addToScene(this);\r\n        this.load.rexWebFont({\r\n            google: {\r\n                families: this.game.config.Game.fonts\r\n            }\r\n        });\r\n        */\r\n    };\r\n    GameOverScene.prototype.create = function () {\r\n        var _this = this;\r\n        var gameWidth = this.cameras.main.width;\r\n        var gameHeight = this.cameras.main.height;\r\n        var sceneText;\r\n        if (this.winner.id == this.ass.id) {\r\n            this.ass.wins += 1;\r\n            this.winnerAnimation();\r\n            sceneText = this.add.text(0, 0, 'WINNER', {\r\n                fontFamily: 'Luckiest Guy',\r\n                fontSize: '80px',\r\n                color: '0x99EDCC'\r\n            });\r\n        }\r\n        else {\r\n            this.ass.losses += 1;\r\n            sceneText = this.add.text(0, 0, 'YOU LOST!', {\r\n                fontFamily: 'Luckiest Guy',\r\n                fontSize: '80px',\r\n                color: '0xFF0000'\r\n            });\r\n        }\r\n        var textBounds = sceneText.getBounds();\r\n        sceneText.setPosition(gameWidth / 2 - textBounds.width / 2, gameHeight / 4);\r\n        this.add.existing(sceneText);\r\n        var playButton = new Button(this, { x: gameWidth / 4, y: gameHeight / 1.4, text: 'Play Again', callback: function () { return _this.playAgain(); } });\r\n        var quitButton = new Button(this, { x: gameWidth / 1.37, y: gameHeight / 1.4, text: 'Quit', callback: function () { return _this.quitGame(); } });\r\n    };\r\n    GameOverScene.prototype.winnerAnimation = function () {\r\n        var p0 = new Phaser.Math.Vector2(200, 500);\r\n        var p1 = new Phaser.Math.Vector2(200, 200);\r\n        var p2 = new Phaser.Math.Vector2(600, 200);\r\n        var p3 = new Phaser.Math.Vector2(600, 500);\r\n        var curve = new Phaser.Curves.CubicBezier(p0, p1, p2, p3);\r\n        var max = 28;\r\n        var points = [];\r\n        var tangents = [];\r\n        for (var c = 0; c <= max; c++) {\r\n            var t = curve.getUtoTmapping(c / max, max);\r\n            points.push(curve.getPoint(t));\r\n            tangents.push(curve.getTangent(t));\r\n        }\r\n        var tempVec = new Phaser.Math.Vector2();\r\n        var spark0 = this.add.particles('red');\r\n        var spark1 = this.add.particles('blue');\r\n        for (var i = 0; i < points.length; i++) {\r\n            var p = points[i];\r\n            tempVec.copy(tangents[i]).normalizeRightHand().scale(-32).add(p);\r\n            var angle = Phaser.Math.RadToDeg(Phaser.Math.Angle.BetweenPoints(p, tempVec));\r\n            var particles = (i % 2 === 0) ? spark0 : spark1;\r\n            particles.createEmitter({\r\n                x: tempVec.x,\r\n                y: tempVec.y,\r\n                angle: angle,\r\n                speed: { min: -100, max: 500 },\r\n                gravityY: 200,\r\n                scale: {\r\n                    start: 0.4,\r\n                    end: 0.1\r\n                },\r\n                lifespan: 900,\r\n                blendMode: 'SCREEN'\r\n            });\r\n        }\r\n    };\r\n    GameOverScene.prototype.playAgain = function () {\r\n        var _this = this;\r\n        this.doUpdates(function () {\r\n            _this.scene.start('wagerScene', { asses: _this.asses });\r\n        });\r\n    };\r\n    GameOverScene.prototype.quitGame = function () {\r\n        var _this = this;\r\n        var quitModal = new ScoreModal(this, function (name) {\r\n            globalThis.socket.emit('add-score', { name: name, cash: _this.registry.get('cash') });\r\n            globalThis.socket.on('add-score-response', function (result) {\r\n                _this.scores = result.scores;\r\n                _this.doUpdates(function () {\r\n                    _this.scene.start('menuScene', { asses: _this.asses, scores: _this.scores });\r\n                });\r\n            });\r\n        });\r\n        var modal = quitModal.getDialog();\r\n        this.rexUI.modalPromise(modal.setPosition(400, 300), {\r\n            manualClose: true,\r\n            duration: {\r\n                in: 500,\r\n                out: 500\r\n            }\r\n        }).then(function (result) {\r\n            //console.log(result.text);\r\n        });\r\n    };\r\n    GameOverScene.prototype.doUpdates = function (cb) {\r\n        var _this = this;\r\n        var updates = [];\r\n        for (var _i = 0, _a = this.opponents; _i < _a.length; _i++) {\r\n            var opponent = _a[_i];\r\n            if (this.winner.id == opponent.id) {\r\n                opponent.wins += 1;\r\n            }\r\n            else {\r\n                opponent.losses += 1;\r\n            }\r\n            updates.push(opponent);\r\n        }\r\n        updates.push(this.ass);\r\n        globalThis.socket.emit('update-asses', updates);\r\n        globalThis.socket.on('update-asses-response', function (res) {\r\n            _this.asses = res.asses;\r\n            cb();\r\n        });\r\n    };\r\n    return GameOverScene;\r\n}(AR.Classes.Scene));\r\nexport default GameOverScene;\r\n//# sourceMappingURL=gameOver.js.map","references":["/var/www/ass-races/src/components/button.ts","/var/www/ass-races/src/components/score-modal.ts"],"map":"{\"version\":3,\"file\":\"gameOver.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/scenes/gameOver.ts\"],\"names\":[],\"mappings\":\";AAAA,OAAO,MAAM,MAAM,yBAAyB,CAAC;AAC7C,OAAO,UAAU,MAAM,8BAA8B,CAAC;AAEtD;IAA4B,iCAAgB;IAO3C;eACC,kBAAM,EAAC,GAAG,EAAE,eAAe,EAAC,CAAC;IAC9B,CAAC;IAED,4BAAI,GAAJ,UAAK,IAAI;QACR,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;QACpB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QAC1B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;IACjC,CAAC;IAED,+BAAO,GAAP;QACC;;;;;;;UAOE;IACH,CAAC;IAED,8BAAM,GAAN;QAAA,iBA4BC;QA3BA,IAAI,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC;QACxC,IAAI,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC;QAC1C,IAAI,SAAS,CAAC;QAEd,IAAG,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,IAAI,CAAC,GAAG,CAAC,EAAE,EAAC;YAChC,IAAI,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,CAAC;YACnB,IAAI,CAAC,eAAe,EAAE,CAAC;YAEvB,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,QAAQ,EAAE;gBACzC,UAAU,EAAE,cAAc;gBAC1B,QAAQ,EAAE,MAAM;gBAChB,KAAK,EAAE,UAAU;aACjB,CAAC,CAAC;SACH;aAAI;YACJ,IAAI,CAAC,GAAG,CAAC,MAAM,IAAI,CAAC,CAAC;YACrB,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,WAAW,EAAE;gBAC5C,UAAU,EAAE,cAAc;gBAC1B,QAAQ,EAAE,MAAM;gBAChB,KAAK,EAAE,UAAU;aACjB,CAAC,CAAC;SACH;QACD,IAAI,UAAU,GAAG,SAAS,CAAC,SAAS,EAAE,CAAC;QACvC,SAAS,CAAC,WAAW,CAAC,SAAS,GAAC,CAAC,GAAC,UAAU,CAAC,KAAK,GAAC,CAAC,EAAE,UAAU,GAAC,CAAC,CAAC,CAAC;QACpE,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;QAE7B,IAAI,UAAU,GAAG,IAAI,MAAM,CAAC,IAAI,EAAE,EAAC,CAAC,EAAE,SAAS,GAAC,CAAC,EAAE,CAAC,EAAE,UAAU,GAAC,GAAG,EAAE,IAAI,EAAE,YAAY,EAAE,QAAQ,EAAE,cAAM,OAAA,KAAI,CAAC,SAAS,EAAE,EAAhB,CAAgB,EAAC,CAAC,CAAC;QAC7H,IAAI,UAAU,GAAG,IAAI,MAAM,CAAC,IAAI,EAAE,EAAC,CAAC,EAAE,SAAS,GAAC,IAAI,EAAE,CAAC,EAAE,UAAU,GAAC,GAAG,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,cAAM,OAAA,KAAI,CAAC,QAAQ,EAAE,EAAf,CAAe,EAAC,CAAC,CAAC;IAC1H,CAAC;IAED,uCAAe,GAAf;QACC,IAAI,EAAE,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAC3C,IAAI,EAAE,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAC3C,IAAI,EAAE,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAC3C,IAAI,EAAE,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAE3C,IAAI,KAAK,GAAG,IAAI,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;QAE1D,IAAI,GAAG,GAAG,EAAE,CAAC;QACb,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,IAAI,QAAQ,GAAG,EAAE,CAAC;QAElB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,GAAG,EAAE,CAAC,EAAE,EAAE;YAC9B,IAAI,CAAC,GAAG,KAAK,CAAC,cAAc,CAAC,CAAC,GAAG,GAAG,EAAE,GAAG,CAAC,CAAC;YAE3C,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;YAC/B,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;SACnC;QAED,IAAI,OAAO,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;QAExC,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QACvC,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QAExC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACvC,IAAI,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;YACjB,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,kBAAkB,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAClE,IAAI,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC;YAE9E,IAAI,SAAS,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC;YAEhD,SAAS,CAAC,aAAa,CAAC;gBACvB,CAAC,EAAE,OAAO,CAAC,CAAC;gBACZ,CAAC,EAAE,OAAO,CAAC,CAAC;gBACZ,KAAK,EAAE,KAAK;gBACZ,KAAK,EAAE,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE;gBAC9B,QAAQ,EAAE,GAAG;gBACb,KAAK,EAAE;oBACN,KAAK,EAAE,GAAG;oBACV,GAAG,EAAE,GAAG;iBACR;gBACD,QAAQ,EAAE,GAAG;gBACb,SAAS,EAAE,QAAQ;aACnB,CAAC,CAAC;SACH;IACF,CAAC;IAED,iCAAS,GAAT;QAAA,iBAIC;QAHA,IAAI,CAAC,SAAS,CAAC;YACd,KAAI,CAAC,KAAK,CAAC,KAAK,CAAC,YAAY,EAAE,EAAC,KAAK,EAAE,KAAI,CAAC,KAAK,EAAC,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC;IAED,gCAAQ,GAAR;QAAA,iBAqBC;QApBA,IAAI,SAAS,GAAG,IAAI,UAAU,CAAC,IAAI,EAAE,UAAC,IAAI;YACzC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,EAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,KAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,EAAC,CAAC,CAAC;YACnF,UAAU,CAAC,MAAM,CAAC,EAAE,CAAC,oBAAoB,EAAE,UAAC,MAAM;gBACjD,KAAI,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;gBAE5B,KAAI,CAAC,SAAS,CAAC;oBACd,KAAI,CAAC,KAAK,CAAC,KAAK,CAAC,WAAW,EAAE,EAAC,KAAK,EAAE,KAAI,CAAC,KAAK,EAAE,MAAM,EAAE,KAAI,CAAC,MAAM,EAAC,CAAC,CAAC;gBACzE,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QACH,IAAI,KAAK,GAAG,SAAS,CAAC,SAAS,EAAE,CAAC;QAClC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,KAAK,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE;YACpD,WAAW,EAAE,IAAI;YACjB,QAAQ,EAAE;gBACT,EAAE,EAAE,GAAG;gBACP,GAAG,EAAE,GAAG;aACR;SACD,CAAC,CAAC,IAAI,CAAC,UAAU,MAAM;YACvB,2BAA2B;QAC5B,CAAC,CAAC,CAAC;IACJ,CAAC;IAED,iCAAS,GAAT,UAAU,EAAE;QAAZ,iBAiBC;QAhBA,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,KAAoB,UAAc,EAAd,KAAA,IAAI,CAAC,SAAS,EAAd,cAAc,EAAd,IAAc,EAAC;YAA/B,IAAI,QAAQ,SAAA;YACf,IAAG,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,QAAQ,CAAC,EAAE,EAAC;gBAChC,QAAQ,CAAC,IAAI,IAAI,CAAC,CAAC;aACnB;iBAAI;gBACJ,QAAQ,CAAC,MAAM,IAAI,CAAC,CAAC;aACrB;YACD,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SACvB;QACD,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAEvB,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;QAChD,UAAU,CAAC,MAAM,CAAC,EAAE,CAAC,uBAAuB,EAAE,UAAC,GAAG;YACjD,KAAI,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;YACvB,EAAE,EAAE,CAAC;QACN,CAAC,CAAC,CAAC;IACJ,CAAC;IACF,oBAAC;AAAD,CAAC,AAxJD,CAA4B,EAAE,CAAC,OAAO,CAAC,KAAK,GAwJ3C;AAED,eAAe,aAAa,CAAC\"}"}
